<script>

  window.emails = [];

  function handleError(res) {
    console.log("[debug]: " + res.responseText)
  }

  function displayEmails() {
    document.querySelector("#output").innerHTML = emails.join(", ")
  }

  function processEvents(res) {
    if(res.target.status == 200) {
      var events = JSON.parse(res.target.response);
      for (var i in events) {
        var event = events[i];

        if (event.type === "PushEvent" && event.payload.commits && event.payload.commits[0]) {
          var author = event.payload.commits[0].author;
          if (emails.indexOf(author.email) == -1) {
            emails.push(author.email);
            displayEmails();
          }
        }
      }
    }
  }

  function fetchEvents(user) {
    var url = "https://api.github.com/users/" + user + "/events/public";
    var req = new XMLHttpRequest()
    req.open("GET", url)
    req.header = req.setRequestHeader
    req.setRequestHeader("Content-Type", "application/json")
    req.addEventListener("error", handleError)
    req.addEventListener("load", processEvents)
    req.send()
  }

  document.addEventListener('DOMContentLoaded', function(){
    document.querySelector("#input").addEventListener('change', function(event) {

      emails = [];
      displayEmails()

      var users = event.target.value.split(",").map(function(e) {return e.replace(/ /g,'') });
      for (var i in users) {
        fetchEvents(users[i]);
      }
    });
  });

</script>

<style>

  body {
    font-family: "helvetica neue", helvetica, arial;
    font-weight: bold;
    font-size: 18px;
  }

  #input {
    font-family: "helvetica neue", helvetica, arial;
    font-weight: bold;
    padding: 10px;
    font-size: 18px;
    width: 100%;
  }

  #output {
    padding: 10px 8px;
  }

</style>

<title>Github Email Finder</title>
<input type="text" id="input" placeholder="Enter comma-delimited GitHub usernames">
<div id="output"></div>


